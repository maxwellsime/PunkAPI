package com.punk

import com.punk.utilities.configureRouting
import io.ktor.http.*
import io.ktor.serialization.kotlinx.json.*
import io.ktor.server.plugins.contentnegotiation.*
import io.ktor.server.application.*
import io.ktor.client.request.*
import io.ktor.client.statement.*
import kotlin.test.*
import io.ktor.server.testing.*
import kotlinx.coroutines.runBlocking

class ApplicationTest {
    // Test /beers route.
    @Test
    fun testBeers() = testApplication {
        runBlocking{
            application {
                configureRouting()
                install(ContentNegotiation){
                    json()
                }
            }

            val response = client.get("/beers")
            assertEquals(
                """
                    [{"id":1,"name":"Buzz","description":"A light, crisp and bitter IPA brewed with English and American hops. A small batch brewed only once."},{"id":2,"name":"Trashy Blonde","description":"A titillating, neurotic, peroxide punk of a Pale Ale. Combining attitude, style, substance, and a little bit of low self esteem for good measure; what would your mother say? The seductive lure of the sassy passion fruit hop proves too much to resist. All that is even before we get onto the fact that there are no additives, preservatives, pasteurization or strings attached. All wrapped up with the customary BrewDog bite and imaginative twist."},{"id":3,"name":"Berliner Weisse With Yuzu - B-Sides","description":"Japanese citrus fruit intensifies the sour nature of this German classic."},{"id":4,"name":"Pilsen Lager","description":"Our Unleash the Yeast series was an epic experiment into the differences in aroma and flavour provided by switching up your yeast. We brewed up a wort with a light caramel note and some toasty biscuit flavour, and hopped it with Amarillo and Centennial for a citrusy bitterness. Everything else is down to the yeast. Pilsner yeast ferments with no fruity esters or spicy phenols, although it can add a hint of butterscotch."},{"id":5,"name":"Avery Brown Dredge","description":"An Imperial Pilsner in collaboration with beer writers. Tradition. Homage. Revolution. We wanted to showcase the awesome backbone of the Czech brewing tradition, the noble Saaz hop, and also tip our hats to the modern beers that rock our world, and the people who make them."},{"id":6,"name":"Electric India","description":"Re-brewed as a spring seasonal, this beer – which appeared originally as an Equity Punk shareholder creation – retains its trademark spicy, fruity edge. A perfect blend of Belgian Saison and US IPA, crushed peppercorns and heather honey are also added to produce a genuinely unique beer."},{"id":7,"name":"AB:12","description":"An Imperial Black Belgian Ale aged in old Invergordon Scotch whisky barrels with mountains of raspberries, tayberries and blackberries in each cask. Decadent but light and dry, this beer would make a fantastic base for ageing on pretty much any dark fruit - we used raspberries, tayberries and blackberries beause they were local."},{"id":8,"name":"Fake Lager","description":"Fake is the new black. Fake is where it is at. Fake Art, fake brands, fake breasts, and fake lager. We want to play our part in the ugly fallout from the Lager Dream. Say hello to Fake Lager – a zesty, floral 21st century faux masterpiece with added BrewDog bitterness."},{"id":9,"name":"AB:07","description":"Whisky cask-aged imperial scotch ale. Beer perfect for when the rain is coming sideways. Liquorice, plum and raisin temper the warming alcohol, producing a beer capable of holding back the Scottish chill."},{"id":10,"name":"Bramling X","description":"Good old Bramling Cross is elegant, refined, assured, (boring) and understated. Understated that is unless you hop the living daylights out of a beer with it. This is Bramling Cross re-invented and re-imagined, and shows just what can be done with English hops if you use enough of them. Poor Bramling Cross normally gets lost in a woeful stream of conformist brown ales made by sleepy cask ale brewers. But not anymore. This beer shows that British hops do have some soul, and is a fruity riot of blackberries, pears, and plums. Reminds me of the bramble, apple and ginger jam my grandmother used to make."},{"id":11,"name":"Misspent Youth","description":"The brainchild of our small batch brewer, George Woods. A dangerously drinkable milk sugar- infused Scotch Ale."},{"id":12,"name":"Arcade Nation","description":"Running the knife-edge between an India Pale Ale and a Stout, this particular style is one we truly love. Black IPAs are a great showcase for the skill of our brew team, balancing so many complex and twisting flavours in the same moment. The citrus, mango and pine from the hops – three of our all-time favourites – play off against the roasty dryness from the malt bill at each and every turn."},{"id":13,"name":"Movember","description":"A deliciously robust, black malted beer with a decadent dark, dry cocoa flavour that provides an enticing backdrop to the Cascade hops."},{"id":14,"name":"Alpha Dog","description":"A fusion of caramel malt flavours and punchy New Zealand hops. A session beer you can get your teeth into."},{"id":15,"name":"Mixtape 8","description":"This recipe is for the Belgian Tripel base. A blend of two huge oak aged beers – half a hopped up Belgian Tripel, and half a Triple India Pale Ale. Both aged in single grain whisky barrels for two years and blended, each beer brings its own character to the mix. The Belgian Tripel comes loaded with complex spicy, fruity esters, and punchy citrus hop character."},{"id":16,"name":"Libertine Porter","description":"An avalanche of cross-continental hop varieties give this porter a complex spicy, resinous and citrusy aroma, with a huge malt bill providing a complex roasty counterpoint. Digging deeper into the flavour draws out cinder toffee, bitter chocolate and hints of woodsmoke."},{"id":17,"name":"AB:06","description":"Our sixth Abstrakt, this imperial black IPA combined dark malts with a monumental triple dry-hop, using an all-star team of some of our favourite American hops. Roasty and resinous."},{"id":18,"name":"Russian Doll – India Pale Ale","description":"The levels of hops vary throughout the range. We love hops, so all four beers are big, bitter badasses, but by tweaking the amount of each hop used later in the boil and during dry- hopping, we can balance the malty backbone with some unexpected flavours. Simcoe is used in the whirlpool for all four beers, and yet still lends different characters to each"},{"id":19,"name":"Hello My Name Is Mette-Marit","description":"We sent this beer to Norway where it was known as 'Hello, my name is Censored’. You can make up your own mind as to why. This brew was a red berry explosion, with a reisnous bitter edge layered with dry berry tartness."},{"id":20,"name":"Rabiator","description":"Imperial Wheat beer / Weizenbock brewed by a homesick German in leather trousers. Think banana bread, bubble gum and David Hasselhoff."},{"id":21,"name":"Vice Bier","description":"Our take on the classic German Kristallweizen. A clear German wheat beer, layers of bubblegum and vanilla perfectly balanced with the American and New Zealand hops."},{"id":22,"name":"Devine Rebel (w/ Mikkeller)","description":"Two of Europe's most experimental, boundary-pushing brewers, BrewDog and Mikkeller, combined forces to produce a rebellious beer that combined their respective talents and brewing skills. The 12.5% Barley Wine fermented well, and the champagne yeast drew it ever closer to 12.5%. The beer was brewed with a single hop variety and was going to be partially aged in oak casks."},{"id":23,"name":"Storm","description":"Dark and powerful Islay magic infuses this tropical sensation of an IPA. Using the original Punk IPA as a base, we boosted the ABV to 8% giving it some extra backbone to stand up to the peated smoke imported directly from Islay."},{"id":24,"name":"The End Of History","description":"The End of History: The name derives from the famous work of philosopher Francis Fukuyama, this is to beer what democracy is to history. Complexity defined. Floral, grapefruit, caramel and cloves are intensified by boozy heat."},{"id":25,"name":"Bad Pixie","description":"2008 Prototype beer, a 4.7% wheat ale with crushed juniper berries and citrus peel."}]
                """.trimIndent(),
                response.bodyAsText()
            )
            assertEquals(HttpStatusCode.OK, response.status)
        }
    }

    // test /beers route ?beer_name query.
    @Test
    fun testBeerName() = testApplication {
        runBlocking {
            application {
                configureRouting()
                install(ContentNegotiation){
                    json()
                }
            }
        }

        // Testing correct response to a genuine query
        val response = client.get("/beers?beer_name=Bn")
        assertEquals(
            """
                [{"id":2,"name":"Trashy Blonde","description":"A titillating, neurotic, peroxide punk of a Pale Ale. Combining attitude, style, substance, and a little bit of low self esteem for good measure; what would your mother say? The seductive lure of the sassy passion fruit hop proves too much to resist. All that is even before we get onto the fact that there are no additives, preservatives, pasteurization or strings attached. All wrapped up with the customary BrewDog bite and imaginative twist."},{"id":3,"name":"Berliner Weisse With Yuzu - B-Sides","description":"Japanese citrus fruit intensifies the sour nature of this German classic."},{"id":5,"name":"Avery Brown Dredge","description":"An Imperial Pilsner in collaboration with beer writers. Tradition. Homage. Revolution. We wanted to showcase the awesome backbone of the Czech brewing tradition, the noble Saaz hop, and also tip our hats to the modern beers that rock our world, and the people who make them."},{"id":10,"name":"Bramling X","description":"Good old Bramling Cross is elegant, refined, assured, (boring) and understated. Understated that is unless you hop the living daylights out of a beer with it. This is Bramling Cross re-invented and re-imagined, and shows just what can be done with English hops if you use enough of them. Poor Bramling Cross normally gets lost in a woeful stream of conformist brown ales made by sleepy cask ale brewers. But not anymore. This beer shows that British hops do have some soul, and is a fruity riot of blackberries, pears, and plums. Reminds me of the bramble, apple and ginger jam my grandmother used to make."},{"id":16,"name":"Libertine Porter","description":"An avalanche of cross-continental hop varieties give this porter a complex spicy, resinous and citrusy aroma, with a huge malt bill providing a complex roasty counterpoint. Digging deeper into the flavour draws out cinder toffee, bitter chocolate and hints of woodsmoke."},{"id":34,"name":"Bourbon Baby","description":"Santa Paws Scotch ale aged in bourbon barrels - light, dry and toasty, with vanilla, hints of chocolate and ginger biscuit, and a faint spicy hoppiness."},{"id":35,"name":"Berliner Weisse With Raspberries And Rhubarb - B-Sides","description":"Tart, dry and acidic with a punch of summer berry as rhubarb crumble."},{"id":38,"name":"Belgian Trappist","description":"Our Unleash the Yeast series was an epic experiment into the differences in aroma and flavour provided by switching up your yeast. We brewed up a wort with a light caramel note and some toasty biscuit flavour, and hopped it with Amarillo and Centennial for a citrusy bitterness. Everything else is down to the yeast. Abbey style yeasts add distinctive spicy and fruity notes, and dry out the finished beer."},{"id":54,"name":"Albino Squid Assasin","description":"This tentacled terminator packs a punch - ten punches to be precise. Each hop addition adds to the intense layers of depth in this red rye IPA. Toasty caramel & cinder toffee from crystal malts, cacao richness from intensely roasted malt and the spiciness of rye. Zesty pithiness from Citra and the robust resin of Chinook. This small batch exclusive brew is up-front intensity matched with twisted complexity. The can features awesome custom art from Joe Wilson."},{"id":56,"name":"Black Eyed King Imp","description":"An early Cocoa Psycho recipe that we loved, but didn't fit what we were looking for. We locked this chocolate coffee stout away in barrels for two years, imparting toasted marshmallow, spicy vanilla, molasses and boozy warmth."},{"id":61,"name":"Magic Stone Dog (w/Magic Rock & Stone Brewing Co.)","description":"A session IPA brewed with a diverse grain bill, hopped with Simcoe and Amarillo and fermented with saison yeast, for an incredible level of depth in a low ABV beer. Spicy, fruity, complex, refreshing and dry."},{"id":65,"name":"Bracken's Porter","description":"The beer was named Bracken’s Porter as a tribute to our favourite four pawed friend who sadly passed in 2013. Chocolately, robust, warming, laid back and lots of fun - there are plenty of similarities between the two. Bracken we miss you and we hope you like your beer. Long live the original BrewDog."},{"id":73,"name":"Black Eyed King Imp - Vietnamese Coffee Edition","description":"This is the Vietnamese Coffee Edition. At 12.7% ABV, Black Eyed King Imp is a super intense and twistedly complex brew, with intense notes of sweet vanilla, rich espresso, smooth molasses and bitter chocolate barely contained by the whatever container it's in."},{"id":82,"name":"Hopped-Up Brown Ale - Prototype Challenge","description":"Brown ales are perfect foils for resinous C-Hops, as the piney elements of the latter contrast brilliantly with the sweeter, nutty elements of the malt bill. The best of both worlds."},{"id":84,"name":"Baby Saison - B-Sides","description":"A hark back to the origins of Saison; slight spice and earthy notes with highlights of lemon and pepper make a beer that could quench the thirst of any seasonal worker."},{"id":88,"name":"Bavarian Weizen","description":"Our Unleash the Yeast series was an epic experiment into the differences in aroma and flavour provided by switching up your yeast. We brewed up a wort with a light caramel note and some toasty biscuit flavour, and hopped it with Amarillo and Centennial for a citrusy bitterness. Everything else is down to the yeast. Bavarian Weizen yeast adds traditional weissbier notes of banana and clove."},{"id":97,"name":"Bowman's Beard - B-Sides","description":"Ice-distilled double barley wine brewed by Chris from Stone Brewing Co. (see Sunmaid Stout) and BrewDog's own brewers. As robust, resinous and badass as its eponymic beard."},{"id":111,"name":"Vagabond Pilsner","description":"Take the thirst-quenching crispness of a German Pilsner and combine it with lemon and honey to produce a rewarding modern twist on a beer classic."},{"id":114,"name":"U-Boat (w/ Victory Brewing)","description":"On the palate is a big dark malt sweetness, balanced by the blend of spicy Mittelfruh and citrussy Galena. Cocoa powder, rich dark chocolate, and ripe berries interplay with a toasty burnt sugar bitterness. The mouthfeel is thick and chewy with a treacly quality that doesn’t cloy, as it plays off against the hops and roast malt bitterness."},{"id":118,"name":"Bounty Hunter - Shareholder Brew","description":"Brewed with our Equity Punks this rich, smooth stout is brewed with a blend of six malts, resulting in a welcoming, resonant black beer. From start to finish it carries an intense roastiness reminiscent of dark chocolate intertwined with a delicate hint of coconut and caramel."},{"id":133,"name":"Black Eye Joe (w/ Stone Brewing Co)","description":"A fresh tropical hit from this Black IPA, with undertones of roasted coffee. A well balanced, drinkable yet complex beer."},{"id":139,"name":"Born To Die","description":"Savagely bitter, exceptionally dry, this IPA is born to die on a predetermined day. It proudly displays its short-lived life span front and centre. There is no better time to drink this than the moment you get your paws on it. Awesome bitterness backed up by unrelenting aromas of resin, citrus, and juicy fruit. Born To Die is a eulogy to the hops that sacrificed themselves in its creation. An incredibly ambitious and satisfying small batch brew."},{"id":143,"name":"Lizard Bride - Prototype Challenge","description":"Wonderfully tart, bitter, piney and filled with the fruity elements from raspberries, blueberries and sour cherries. Oh, and it’s purple."},{"id":151,"name":"Rhubarb Saison - B-Sides","description":"Spiced peppercorn and rhubarb Saison."},{"id":159,"name":"Black Tokyo Horizon (w/Nøgne Ø & Mikkeller)","description":"Special Collaboration between Nøgne, Mikkeller and BrewDog which is a recipe based on all three brewers’ big stouts; Nøgne Ø Dark Horizon, Mikkeller Black and BrewDog Tokyo*."}]
            """.trimIndent(),
            response.bodyAsText()
        )
        assertEquals(HttpStatusCode.OK, response.status)

        // Testing correct response to an empty query, responds with page 1 of beers
        val response2 = client.get("/beers?beer_name=")
        assertEquals(
            """
                [{"id":1,"name":"Buzz","description":"A light, crisp and bitter IPA brewed with English and American hops. A small batch brewed only once."},{"id":2,"name":"Trashy Blonde","description":"A titillating, neurotic, peroxide punk of a Pale Ale. Combining attitude, style, substance, and a little bit of low self esteem for good measure; what would your mother say? The seductive lure of the sassy passion fruit hop proves too much to resist. All that is even before we get onto the fact that there are no additives, preservatives, pasteurization or strings attached. All wrapped up with the customary BrewDog bite and imaginative twist."},{"id":3,"name":"Berliner Weisse With Yuzu - B-Sides","description":"Japanese citrus fruit intensifies the sour nature of this German classic."},{"id":4,"name":"Pilsen Lager","description":"Our Unleash the Yeast series was an epic experiment into the differences in aroma and flavour provided by switching up your yeast. We brewed up a wort with a light caramel note and some toasty biscuit flavour, and hopped it with Amarillo and Centennial for a citrusy bitterness. Everything else is down to the yeast. Pilsner yeast ferments with no fruity esters or spicy phenols, although it can add a hint of butterscotch."},{"id":5,"name":"Avery Brown Dredge","description":"An Imperial Pilsner in collaboration with beer writers. Tradition. Homage. Revolution. We wanted to showcase the awesome backbone of the Czech brewing tradition, the noble Saaz hop, and also tip our hats to the modern beers that rock our world, and the people who make them."},{"id":6,"name":"Electric India","description":"Re-brewed as a spring seasonal, this beer – which appeared originally as an Equity Punk shareholder creation – retains its trademark spicy, fruity edge. A perfect blend of Belgian Saison and US IPA, crushed peppercorns and heather honey are also added to produce a genuinely unique beer."},{"id":7,"name":"AB:12","description":"An Imperial Black Belgian Ale aged in old Invergordon Scotch whisky barrels with mountains of raspberries, tayberries and blackberries in each cask. Decadent but light and dry, this beer would make a fantastic base for ageing on pretty much any dark fruit - we used raspberries, tayberries and blackberries beause they were local."},{"id":8,"name":"Fake Lager","description":"Fake is the new black. Fake is where it is at. Fake Art, fake brands, fake breasts, and fake lager. We want to play our part in the ugly fallout from the Lager Dream. Say hello to Fake Lager – a zesty, floral 21st century faux masterpiece with added BrewDog bitterness."},{"id":9,"name":"AB:07","description":"Whisky cask-aged imperial scotch ale. Beer perfect for when the rain is coming sideways. Liquorice, plum and raisin temper the warming alcohol, producing a beer capable of holding back the Scottish chill."},{"id":10,"name":"Bramling X","description":"Good old Bramling Cross is elegant, refined, assured, (boring) and understated. Understated that is unless you hop the living daylights out of a beer with it. This is Bramling Cross re-invented and re-imagined, and shows just what can be done with English hops if you use enough of them. Poor Bramling Cross normally gets lost in a woeful stream of conformist brown ales made by sleepy cask ale brewers. But not anymore. This beer shows that British hops do have some soul, and is a fruity riot of blackberries, pears, and plums. Reminds me of the bramble, apple and ginger jam my grandmother used to make."},{"id":11,"name":"Misspent Youth","description":"The brainchild of our small batch brewer, George Woods. A dangerously drinkable milk sugar- infused Scotch Ale."},{"id":12,"name":"Arcade Nation","description":"Running the knife-edge between an India Pale Ale and a Stout, this particular style is one we truly love. Black IPAs are a great showcase for the skill of our brew team, balancing so many complex and twisting flavours in the same moment. The citrus, mango and pine from the hops – three of our all-time favourites – play off against the roasty dryness from the malt bill at each and every turn."},{"id":13,"name":"Movember","description":"A deliciously robust, black malted beer with a decadent dark, dry cocoa flavour that provides an enticing backdrop to the Cascade hops."},{"id":14,"name":"Alpha Dog","description":"A fusion of caramel malt flavours and punchy New Zealand hops. A session beer you can get your teeth into."},{"id":15,"name":"Mixtape 8","description":"This recipe is for the Belgian Tripel base. A blend of two huge oak aged beers – half a hopped up Belgian Tripel, and half a Triple India Pale Ale. Both aged in single grain whisky barrels for two years and blended, each beer brings its own character to the mix. The Belgian Tripel comes loaded with complex spicy, fruity esters, and punchy citrus hop character."},{"id":16,"name":"Libertine Porter","description":"An avalanche of cross-continental hop varieties give this porter a complex spicy, resinous and citrusy aroma, with a huge malt bill providing a complex roasty counterpoint. Digging deeper into the flavour draws out cinder toffee, bitter chocolate and hints of woodsmoke."},{"id":17,"name":"AB:06","description":"Our sixth Abstrakt, this imperial black IPA combined dark malts with a monumental triple dry-hop, using an all-star team of some of our favourite American hops. Roasty and resinous."},{"id":18,"name":"Russian Doll – India Pale Ale","description":"The levels of hops vary throughout the range. We love hops, so all four beers are big, bitter badasses, but by tweaking the amount of each hop used later in the boil and during dry- hopping, we can balance the malty backbone with some unexpected flavours. Simcoe is used in the whirlpool for all four beers, and yet still lends different characters to each"},{"id":19,"name":"Hello My Name Is Mette-Marit","description":"We sent this beer to Norway where it was known as 'Hello, my name is Censored’. You can make up your own mind as to why. This brew was a red berry explosion, with a reisnous bitter edge layered with dry berry tartness."},{"id":20,"name":"Rabiator","description":"Imperial Wheat beer / Weizenbock brewed by a homesick German in leather trousers. Think banana bread, bubble gum and David Hasselhoff."},{"id":21,"name":"Vice Bier","description":"Our take on the classic German Kristallweizen. A clear German wheat beer, layers of bubblegum and vanilla perfectly balanced with the American and New Zealand hops."},{"id":22,"name":"Devine Rebel (w/ Mikkeller)","description":"Two of Europe's most experimental, boundary-pushing brewers, BrewDog and Mikkeller, combined forces to produce a rebellious beer that combined their respective talents and brewing skills. The 12.5% Barley Wine fermented well, and the champagne yeast drew it ever closer to 12.5%. The beer was brewed with a single hop variety and was going to be partially aged in oak casks."},{"id":23,"name":"Storm","description":"Dark and powerful Islay magic infuses this tropical sensation of an IPA. Using the original Punk IPA as a base, we boosted the ABV to 8% giving it some extra backbone to stand up to the peated smoke imported directly from Islay."},{"id":24,"name":"The End Of History","description":"The End of History: The name derives from the famous work of philosopher Francis Fukuyama, this is to beer what democracy is to history. Complexity defined. Floral, grapefruit, caramel and cloves are intensified by boozy heat."},{"id":25,"name":"Bad Pixie","description":"2008 Prototype beer, a 4.7% wheat ale with crushed juniper berries and citrus peel."}]
            """.trimIndent(),
            response2.bodyAsText()
        )
        assertEquals(HttpStatusCode.OK, response2.status)

        // Testing correct response to an invalid query
        val response3 = client.get("/beers?beer_name=xxxxxxxxxxxxxxxxxxxxxxxx")
        assertEquals(
            """
                "No beers with names including: xxxxxxxxxxxxxxxxxxxxxxxx."
            """.trimIndent(),
            response3.bodyAsText())
        //assertEquals(HttpStatusCode.NotFound, response3.status)
    }

    // test /beers route ?page query.
    @Test
    fun testBeerPage() = testApplication {
        runBlocking {
            application {
                configureRouting()
                install(ContentNegotiation){
                    json()
                }
            }
        }

        // Testing correct response to a genuine query
        val response = client.get("/beers?page=10")
        assertEquals(
            """
                [{"id":226,"name":"Chili Hammer","description":"Chili Hammer is the third of our super-charged hyped up hybrids. A smooth tongued spicy assassin. Chili and American hops unite for a flavour bigger than Texas. Citrus peel, mango, with a hint of spice on the nose. Delivers big grapefruit and mango with a smooth chili kick, followed by the bitterest of bitter finishes. Chili Hammer – turn up the gas."},{"id":227,"name":"Brewdog Vs Beavertown","description":"Loaded with roasty coffee notes and balanced with complex tobacco character. With smoky flavours from the malt, our Beavertown Collab is barrel-aged, but we don’t know for how long until its ready!"},{"id":228,"name":"Prototype Helles","description":"Our spin on one-of the most popular beer styles ever conceived. A celebration of light, bready malt, with toasty hints and soft bitterness."},{"id":229,"name":"Rye Hammer","description":"Rye Hammer is the fourth of our super-charged hyped up hybrids. A bready beery beast. Rye grains and American hops unite in an agricultural superpower. Aroma of roasted malts, rye bread and subtle floral hops. Grapefruit, roasted caramel with malty fruity notes, followed by the bitterest of bitter finishes. Rye Hammer – liquid daily bread."},{"id":230,"name":"Black Hammer","description":"Jack Hammer has been single handedly ripping it up for quite some time. Now, the definitive bitter and twisted IPA, has spawned four Hammer Head off-springs. Black Hammer is the second of our hyped up hybrid IPAs. A black hearted beast, that takes no prisoners. American hops and dark malt combine to make mischief. Grapefruit and coffee collide in sensory overload – a wake-up call for other IPA’s. Molten waves of pithy grapefruit build and finally ebb to the roasty bitter onslaught. Stand  firm and wield the Black Hammer with care. Stare into the black abyss and succumb to the dark-side."},{"id":231,"name":"Ace Of Chinook","description":"We love hops. We adore and worship their profile ability to transform beer. You could say that we have a terminal addiction. To celebrate this fetish we’re heroing our favourites in single hopped limited releases. No also starring, no extras, no compromise. The Hop is the Hero. A biscuity malty backbone builds to intense resinous pine with pithy citrus notes, culminating in a grapefruit hit and a long bitter finish. Our Ace in the hole, devastatingly singular, deliciously bitter. Serving up an Ace each and every time."},{"id":232,"name":"Ace Of Equinox","description":"We love hops. We adore and worship their profile ability to transform beer. You could say that we have a terminal addiction. To celebrate this fetish we’re heroing our favourites in single hopped limited releases. No also starring, no extras, no compromise. The Hop is the Hero. A biscuity malty backbone builds to intense tropical fruit, with bitter resin notes, culminating with an explosive papya hit and a long bitter finish. Our Ace in the hole, devastatingly singular, deliciously bitter. Serving up an Ace each and every time."},{"id":233,"name":"Ace Of Citra","description":"We love hops. We adore and worship their profile ability to transform beer. You could say that we have a terminal addiction. To celebrate this fetish we’re heroing our favourites in single hopped limited releases. No also starring, no extras, no compromise. The Hop is the Hero. A biscuity malty backbone layered with berry and resin, culminating with a lime zest hit and an explosive bitter citrus finish. Our Ace in the hole, devastatingly singular, deliciously bitter. Serving up an Ace each and every time."},{"id":234,"name":"Neon Overlord","description":"The Overlord of mango and chili IPA’s packs a fruity punch and then some. Pours a slightly hazy orange. A tropical fruit assault on the nose, with mango, pineapple, apricots and citrus. Hints of chili and sweet malts follow. Fruit dissipates to a chili kick, not hot but definitely there, followed by a long bitter finish. All hail to the hot tempered sweet toothed Lord."},{"id":235,"name":"Mango And Chili Barley Wine","description":"A huge, chewy barley wine, loaded with bitterness and balanced with a sweet and spicy combo of mango and chili. A concept brew which was so well received, we tweaked it and it became Neon Overlord."},{"id":236,"name":"Science IPA","description":"A beer brewed specifically for the British Science Festival, held in Swansea."},{"id":237,"name":"Honey And Lemon Blitz","description":"Honey & Lemon Blitz sees tart Berliner Weisse character multiplied by lemony acidity; light bready malt and a hint of warming honey hold this back from the brink of palate- destroying sourness."},{"id":238,"name":"Kingpin","description":"A 4.7% German Pils with light, biscuit and toasty malt character, upon which is built a hop bitterness that provides complexity and a long, dry finish."},{"id":239,"name":"#Mashtag 2016","description":"We gave our customers the keys to the brewery and let them choose every aspect of this beer. Sour cherry combines with fruity hop character against a biscuit malt backbone with a hint of alcohol warmth, and an oaky undercurrent."},{"id":240,"name":"Blitz Saison","description":"Belgium meets Berlin – incredible saison character with a bright and vibrant sour edge."},{"id":241,"name":"Hello My Name Is Ingrid 2016","description":"We asked the public to tell us the one beer we should brew again, from our entire back catalogue. They chose well. Cloudberries team up with pan-global hops for an all out fruit riot against a caramel malt base."},{"id":242,"name":"Crew Brew","description":"Our crew designed it, and we bottled it just for ourselves! We chose an 8% red ale, mash hopped and first wort hopped with New Zealand origin hops."},{"id":243,"name":"Gin Blitz","description":"Our Blitz series sees us brew up low abv, super tart Berliner Weisse, and generally infuse them with bags of sour fruit flavour – but this batch uses gin botanicals instead."},{"id":244,"name":"AB:21","description":"AB:21 is a liquorice and blackcurrant infused imperial stout. Rolling in at an imposing 12% abv, this huge and decadent dark beer dials down the charred roastiness and focuses instead on the rich, full-bodied chocolate and dark fruit character of the style."},{"id":245,"name":"Beatnik","description":"We gave our Equity Punks the keys to the brewery and let them brew the beer, as well as join Q&As and tour our HQ. The beer was voted on exclusively by Equity Punks."},{"id":246,"name":"Casino Rye Ale","description":"We’ve split our bets with Casino Rye Ale and doubled up on the malt front, with barley and rye on the grain bill."},{"id":247,"name":"Self Assembly Pope","description":"A dark and decadent beer brewed with coconut, vanilla, cacao."},{"id":248,"name":"Twin Atlantic","description":"Brewed in collaboration with our AGM-headlining band, Twin Atlantic, this US style pale features some of our favourite hops and is loaded with tropical fruit."},{"id":249,"name":"Hop Shot","description":"Hop Shot is a high-velocity hop hit. Our latest experiment in ice-distillation is a west coast IPA, subjected to Antarctic temperatures and concentrated by removing the ice that forms. The result is a 22% ABV hop grenade in a 110ml bottle."},{"id":250,"name":"Small Batch: Rye IPA","description":"A 7.2% rye IPA loaded with grapefruit notes, pithy citrus, and huge resinous bitterness, with rye character. The Centennial and Columbus flavours are amplified by the spicy, dry rye."}]
            """.trimIndent(),
            response.bodyAsText()
        )
        assertEquals(HttpStatusCode.OK, response.status)

        // Testing correct response to an empty query, responds with page 1 of beers
        val response2 = client.get("/beers?page=n")
        assertEquals(
            """
                "n is not a valid page number."
            """.trimIndent(),
            response2.bodyAsText()
        )
        assertEquals(HttpStatusCode.OK, response2.status)

        // Testing correct response to an invalid query
        val response3 = client.get("/beers?page=100000000")
        assertEquals(
            """
                "Page 100000000 does not exist."
            """.trimIndent(),
            response3.bodyAsText())
        //assertEquals(HttpStatusCode.NotFound, response3.status)
    }

    // Test /beers/{id} route.
    @Test
    fun testBeerByID() = testApplication {
        runBlocking{
            application {
                configureRouting()
                install(ContentNegotiation){
                    json()
                }
            }

            val response = client.get("/beers/1")
            assertEquals(
                """
                    {"id":1,"name":"Buzz","description":"A light, crisp and bitter IPA brewed with English and American hops. A small batch brewed only once."}
                """.trimIndent(),
                response.bodyAsText()
            )
            assertEquals(HttpStatusCode.OK, response.status)

            val response2 = client.get("/beers/2")
            assertEquals(
                """
                    {"id":2,"name":"Trashy Blonde","description":"A titillating, neurotic, peroxide punk of a Pale Ale. Combining attitude, style, substance, and a little bit of low self esteem for good measure; what would your mother say? The seductive lure of the sassy passion fruit hop proves too much to resist. All that is even before we get onto the fact that there are no additives, preservatives, pasteurization or strings attached. All wrapped up with the customary BrewDog bite and imaginative twist."}
                """.trimIndent(),
                response2.bodyAsText()
            )
            assertEquals(HttpStatusCode.OK, response2.status)

            val response3 = client.get("/beers/n")
            assertEquals(
                """
                    "n is not a valid identifier. Identifiers must be short positive integers."
                """.trimIndent(),
                response3.bodyAsText()
            )
            //assertEquals(HttpStatusCode.BadRequest, response3.status)
        }
    }
}